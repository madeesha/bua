#!/bin/bash
# Execute bua
set -feuo pipefail
if [[ $# -ne 2 ]] ; then
  echo "execute-bua-restore <run-date> <snapshot-arn>"
  exit 1
fi
today=$(date +'%Y-%m-%d')
uuid=$(uuid)
run_date="${1}"
snapshot_arn="${2}"
input=$(jq -n --arg rdt "${run_date}" --arg arn "${snapshot_arn}" '{"steps": "Restore", "run_date": "$rdt", "update_id": "14", "snapshot_arn": "$arn"}')
aws --profile anstead --region ap-southeast-2 stepfunctions start-execution \
    --state-machine-arn arn:aws:states:ap-southeast-2:561082505378:stateMachine:tst-anstead-bua \
    --name "${today}-Restore-${uuid}" \
    --input "${input}"
