#!/bin/bash
set -feuo pipefail
my_dir=$(dirname $0)
case "$1" in
  anstead)
    export MYSQL_HOST="${TST_ANSTEAD_SQL}"
    export MYSQL_PORT="3306"
    export MYSQL_USER="core_admin"
    export MYSQL_PWD="${TST_ANSTEAD_SQL_PASS}"
    ;;
  matten)
    export MYSQL_HOST="${PRD_MATTEN_SQL}"
    export MYSQL_PORT="3306"
    export MYSQL_USER="core_admin"
    export MYSQL_PWD="${PRD_MATTEN_SQL_PASS}"
    ;;
  *)
    echo 'Must be either anstead or matten'
    exit 1
esac

echo "Restore triggers from ${2} into ${MYSQL_HOST}"
read -p "Are you sure you wish to continue (Y/N) [N] ?" yesno
if [[ "$yesno" != "Y" ]] ; then
  exit 1
fi

dump_file="/tmp/${2}-triggers.sql"
echo "Restore triggers in ${dump_file}"
cat "${dump_file}" | mysql --host="${MYSQL_HOST}" --port="${MYSQL_PORT}" --user="${MYSQL_USER}" --protocol=tcp Turkey_BLU
echo "Restored triggers in ${dump_file}"
